atemp < quantile(atemp, 0.75) ~ "3. Mild",
TRUE ~ "4. Warm") ) %>% group_by(atemp_disc) %>%
summarise(mean_pct_casual = mean(pct_casual)) %>%
ggplot(aes(x=atemp_disc, y=mean_pct_casual)) + geom_bar(stat="identity") + theme_minimal()
bikes <- read_csv("bikes.csv")
bikes %>% mutate(date_time = make_datetime(year, month, day, hour)) %>%
mutate(`Día de la Semana` = wday(date_time, label = TRUE)) %>%
group_by(hour, `Día de la Semana`) %>% summarise(total_rides = sum(cnt)) %>%
ggplot(aes(x=hour, y=total_rides, color=`Día de la Semana`)) + geom_line() + theme_minimal() +
labs(title = "Total de bicicletas alquiladas por hora y día de la semana", x = "Hora", y = "Total de bicicletas alquiladas")
library(modelr)
y <- 3.0 + 0.5*x + 1.2*x**2 + rnorm(100, 0, 0.1)
df <- data.frame(x = x, y = y)
ggplot(df, aes(x=x, y=y)) + geom_point()
library(tidyverse)
x <- rnorm(100)
y <- 3.0 + 0.5*x + 1.2*x**2 + rnorm(100, 0, 0.1)
df <- data.frame(x = x, y = y)
df
ggplot(df, aes(x=x, y=y)) + geom_point()
y <- 3.0 + 0.5*x + 1.2*x**2 + rnorm(100, 0, 0.5)
df <- data.frame(x = x, y = y)
ggplot(df, aes(x=x, y=y)) + geom_point()
df
df %>% View()
df <- df %>% mutate(x2 = x**2)
head(df)
model <- lm(y ~ x + x2, df)
model
df %>% data_grid(x)
df %>% data_grid(x) %>%  mutate(x2 = x**2)
grid <- df %>% data_grid(x) %>%  mutate(x2 = x**2) %>%
add_predictions(model)
grid
ggpplot(df, aes(x=x)) + geom_point(aes(y=y))
gpplot(df, aes(x=x)) + geom_point(aes(y=y))
ggplot(df, aes(x=x)) + geom_point(aes(y=y))
ggplot(df, aes(x=x)) + geom_point(aes(y=y)) + geom_line(grid, aes(y=pred))
ggplot(df, aes(x=x)) + geom_point(aes(y=y)) + geom_line(grid, aes(y=pred), color="red")
grid <- df %>% data_grid(x) %>%  mutate(x2 = x**2) %>%
add_predictions(model)
grid
ggplot(df, aes(x=x)) + geom_point(aes(y=y)) + geom_line(data=grid, aes(y=pred), color="red")
ggplot(df, aes(x=x)) + geom_point(aes(y=y)) + geom_line(grid, aes(y=pred), color="red")
ggplot(df, aes(x=x)) + geom_point(aes(y=y)) + geom_line(data=grid, aes(y=pred), color="red")
df %>% add_residuals(model)
df %>% add_residuals(model) %>% ggplot(aes(x=x, y = resid))
df %>% add_residuals(model) %>% ggplot(aes(x=x, y = resid)) + geom_point()
coef(model)
library(tidyverse)
library(lubridate)
library(modelr)
# Load the datasets
movies <- read_csv("data/movies.csv")
colnames(movies)
nrow(movies)
colnames(ratings)
ratings <- read_csv("data/ratings.csv")
colnames(ratings)
# Load the datasets
movies <- read_csv("data/movies.csv")
ratings <- read_csv("data/ratings.csv")
# Realizar una unión izquierda
movies_ratings <- left_join(movies, ratings, by = "imdb_title_id")
# Get avg rate and total votes per year
movies_ratings %>%
group_by(year) %>%
summarise(total_votes = sum(total_votes)) %>%
arrange(total_votes) %>% slice(1:5)
# Analizar la relación entre la aparición de palabras clave y el género
movies %>%
mutate(n_loves = str_count(description, pattern = "[Ll]ove")) %>%
group_by(main_genre) %>%
summarise(mean_loves = mean(n_loves, na.rm = TRUE)) %>%
arrange(desc(mean_loves)) %>% slice(1:3)
rest_tickets <- read_csv("data/restaurant_ticketing_may.csv")
rest_tickets_new <- rest_tickets %>% mutate(date_in = dmy(date_in),
date_out = dmy(date_out),
time_in = hms(time_in),
time_out = hms(time_out))
rest_tickets_new  %>% filter(service == "LUNCH") %>%
mutate(time_in_table = as.duration(time_out - time_in) / 60) %>%
summarise(
avg_time_in_table = mean(time_in_table)
)
# Which is the hour when we sell at our highest menu price?
rest_tickets_new %>%
mutate(
hour = hour(time_in)
) %>%
group_by(hour) %>%
summarise(
avg_menu_price = sum(amount)/sum(diners)
) %>%
arrange(desc(avg_menu_price)) %>%
slice(1)
rest_tickets_new %>%
mutate(day_of_week = wday(date_in, label = TRUE, abbr = FALSE),
day_category = if_else(day_of_week %in% c("Saturday", "Sunday"), "Entre Semana", "Fin de Semana"),
hour_in = hour(time_in)) %>% filter(hour_in > 8) %>%
group_by(hour_in, day_category) %>%
summarize(avg_amount_spent = mean(amount, na.rm = TRUE)) %>%
ggplot(aes(x = hour_in, y = avg_amount_spent, color = day_category)) +
geom_point() + geom_line() +
labs(title = "Precio Medio de los Tickets por Hora de Entrada y Categoría del día",
x = "Hora de Entrada",
y = "Precio Medio (en Euros)",
color = "Categoría") +
theme_minimal()
data <- read_csv("data/dosage_response.csv")
data_new <- data %>% mutate(dosage2 = dosage^2)
qmod <- lm(efficacy ~ dosage2 + dosage + sex, data=data_new)
coef(qmod)
grid <- data_new %>% data_grid(dosage, sex) %>% mutate(dosage2=dosage^2) %>% add_predictions(qmod)
ggplot(data_new, aes(x=dosage, color=sex)) + geom_point(aes(y=efficacy)) +
geom_line(data=grid, aes(y=pred), size=3) + theme_minimal()
data_new %>% add_residuals(qmod) %>%
ggplot(aes(x=dosage, y=resid)) + geom_point() + theme_minimal()
res <- replicate(10, gen_1(5))
gen_1 <- function(n=5){
nums <- sample(1:100, size=n, replace=TRUE)
return( sum(nums)/n )
}
res <- replicate(10, gen_1(5))
# Estima el valor de pi: área del cuarto de círculo (pi/4) por el área del cuadrado (1)
pi_estimada <- (puntos_dentro / N) * 4
N <- 10000
x <- runif(N)
y <- runif(N)
# Calcula cuántos puntos caen dentro del cuarto de círculo
puntos_dentro <- sum(x^2 + y^2 <= 1)
# Estima el valor de pi: área del cuarto de círculo (pi/4) por el área del cuadrado (1)
pi_estimada <- (puntos_dentro / N) * 4
pi_estimada
library(tidyverse)
library(nycflights13)
library(lubridate)
library(tidyquant)
time <- 2030
hora <- time%/%100
minutos <- time%%100
print(hora)
print(minutos)
flights_dt <- flights %>% mutate(dep_time = make_datetime(year, month, day,
dep_time %/% 100, dep_time %% 100),
arr_time = make_datetime(year, month, day,
arr_time %/% 100, arr_time %% 100),
sched_dep_time = make_datetime(year, month, day,
sched_dep_time %/% 100, sched_dep_time %% 100),
sched_arr_time = make_datetime(year, month, day,
sched_arr_time %/% 100, sched_arr_time %% 100)
)
flights_dt %>% mutate(difference = as.numeric(arr_time-dep_time)) %>%
mutate(actual_arr_time = ifelse(as.numeric(difference) < 0 , arr_time + days(1), arr_time))
flights_dt %>% mutate(difference = as.numeric(arr_time-dep_time)) %>%
mutate(actual_arr_time = if_else(as.numeric(difference) < 0 , arr_time + days(1), arr_time))
flights_dt %>% mutate(difference = as.numeric(arr_time-dep_time)) %>%
mutate(actual_arr_time = if_else(as.numeric(difference) < 0 , arr_time + days(1), arr_time)) %>%
mutate(difference = actual_arr_time-dep_time ) %>%
ggplot(aes(x=difference, y=air_time,color = tzone.y)) + geom_point()
flights_dt %>% mutate(difference = as.numeric(arr_time-dep_time)) %>%
mutate(actual_arr_time = if_else(as.numeric(difference) < 0 , arr_time + days(1), arr_time)) %>%
mutate(difference = actual_arr_time-dep_time ) %>%
ggplot(aes(x=difference, y=air_time)) + geom_point()
d <- as.POSIXct("2025-01-01 10:00:00")
ifelse(TRUE, d + days(1), d)
if_else(TRUE, d + days(1), d)
diamonds2 <- diamonds %>%
filter(carat <= 2.5) %>%
mutate(lprice = log2(price), lcarat = log2(carat))
knitr::opts_chunk$set(echo = T, warning = F, message = F)
knitr::opts_chunk$set(fig.width=8, fig.height=6)
library(tidyverse)
library(modelr)
ggplot(diamonds, aes(cut, price)) + geom_boxplot()
ggplot(diamonds, aes(color, price)) + geom_boxplot()
ggplot(diamonds, aes(clarity, price)) + geom_boxplot()
mod_diamond <- lm(price ~ carat, data = diamonds)
summary(mod_diamond)
grid <- diamonds %>%
data_grid(carat = seq_range(carat, 40)) %>%
add_predictions(mod_diamond, "price")
diamonds %>% add_residuals(mod_diamond, "resid")
ggplot(diamonds, aes(carat, price)) +
geom_hex(bins = 50) +
geom_line(data = grid, colour = "red", size = 1)
diamonds2 <- diamonds %>%
filter(carat <= 2.5) %>%
mutate(lprice = log2(price), lcarat = log2(carat))
mod_diamond <- lm(lprice ~ lcarat, data = diamonds2)
coefficients(mod_diamond)
grid <- diamonds2 %>% data_grid(lcarat) %>%
add_predictions("lpred")
grid <- diamonds2 %>% data_grid(lcarat) %>%
add_predictions(mod2, "lpred")
grid <- diamonds2 %>% data_grid(lcarat) %>%
add_predictions(mod_diamond, "lpred")
grid
ggplot(diamonds2, aes(lcarat)) +
geom_point( aes(y=lprice) ) +
geom_line(data = grid, aes(y=lpred), colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 20)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
grid
ggplot(diamonds2, aes(carat, price)) +
geom_hex(bins = 50) +
geom_line(data = grid, colour = "red", size = 1)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_line(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 2)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_line(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 10)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_line(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 100)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_line(data = grid, colour = "red", size = 1)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 5)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat = seq_range(carat, 500)) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
diamonds
diamonds %>% head(10)
fumar %>% group_by(gender, smoke) %>% summarise(n=n())
library(tidyverse)
fumar <- read_csv("data/smoking.csv")
fumar %>% group_by(gender, smoke) %>% summarise(n=n())
fumar %>% count(gender, smoke)
fumar %>% count(gender, smoke) %>% mutate(prop=n/sum(n))
```{r, eval=F}
fumar %>% group_by(gender, smoke) %>% summarise(n=n())
fumar %>% group_by(gender, smoke) %>% summarise(n=n()) %>%
mutate(prop=n/sum(n))
fumar %>% group_by(gender, smoke) %>% summarise(n=n()) %>% ungroup() %>%
mutate(prop=n/sum(n))
knitr::opts_chunk$set(eval=F, echo = F, message = F, warning = F, fig.width = 8, fig.height = 5)
library(tidyverse)
library(lubridate)
library(modelr)
weather <- read_csv("data/london_weather.csv")
air <- read_csv("data/london_air_quality.csv")
air %>% mutate(date = as.Date(date)) %>% group_by(date) %>%
summarise(avg_pm25 = mean(bg_pm25, na.rm = TRUE)) %>%
inner_join(weather, by = "date") %>%
filter(tmean_q == 0) %>%
ggplot(aes(x = tmean, y = avg_pm25)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Temperatura media (°C)", y = "PM2.5 (microgramos/m3)", title = "Concentración media de PM2.5 por temperatura") +
theme_minimal()
bbc <- read_csv("data/bbc.csv")
library(lubridate)
fecha <- "2020-01-01"
fecha
ymd(fecha)
library(tidyverse)
library(lubridate)
library(modelr)
soccer <- read_csv("futbol_primera_div.csv")
soccer
str(soccer)
soccer
soccer %>%
mutate(Date = dmy(Date))
ymd_hm("2023-05-13 5:00")
fh <- ymd_hm("2023-05-13 5:00")
class(fh)
fh
as.Date(fh)
make_date(year(fh), month(fh), day(fh))
ymd(fh)
make_date(year(fh))
year(fh)
soccer %>%
mutate(month(Date))
soccer %>%
mutate(Date = dmy(Date), mes = month(Date))
tree <- read_csv("tree.csv")
tree
tree_new <- tree %>% mutate(log_tree_density = log(tree_density))
m
fit <- lm(yield ~ log_tree_density + pruning_system, data = tree_new)
coef(fit)
tree
fit <- lm(yield ~ log_tree_density + pruning_system, data = tree_new)
coef(fit)
tree %>% data_grid(tree_density, pruning_system)
tree %>% data_grid(tree_density, pruning_system) %>%
mutate(log_tree_density = log(tree_density))
tree %>% data_grid(tree_density, pruning_system) %>%
mutate(log_tree_density = log(tree_density)) %>% add_predictions(fit)
grid <- tree %>% data_grid(tree_density, pruning_system) %>%
mutate(log_tree_density = log(tree_density)) %>% add_predictions(fit)
tree_new %>% ggplot(aes(x = tree_density, y = yield, color = pruning_system)) +
geom_point() +
geom_line(data = grid, aes(y = pred), size = 1) +
labs(title = "Rendimiento de los árboles", x = "Densidad de árboles", y = "Rendimiento") +
theme_bw()
tree_new %>% ggplot(aes(x = log_tree_density, y = yield, color = pruning_system)) +
geom_point() +
geom_line(data = grid, aes(y = pred), size = 1) +
labs(title = "Rendimiento de los árboles", x = "Densidad de árboles", y = "Rendimiento") +
theme_bw()
tree_new %>% ggplot(aes(x = tree_density, y = yield, color = pruning_system)) +
geom_point() +
geom_line(data = grid, aes(y = pred), size = 1) +
labs(title = "Rendimiento de los árboles", x = "Densidad de árboles", y = "Rendimiento") +
theme_bw()
tree_new %>% add_residuals(fit) %>%
ggplot(aes(x = tree_density, y = resid, color = pruning_system)) +
geom_point() +
labs(title = "Residuos del modelo", x = "Densidad de árboles", y = "Residuos") +
theme_bw()
tree_new %>% add_residuals(fit) %>%
ggplot(aes(x = log_tree_density, y = resid, color = pruning_system)) +
geom_point() +
labs(title = "Residuos del modelo", x = "Densidad de árboles", y = "Residuos") +
theme_bw()
tree_new %>% add_residuals(fit) %>%
ggplot(aes(x = tree_density, y = resid, color = pruning_system)) +
geom_point() +
labs(title = "Residuos del modelo", x = "Densidad de árboles", y = "Residuos") +
theme_bw()
fit_lin <- lm(yield ~ tree_density + pruning_system, data = tree_new)
tree_new %>% add_residuals(fit_lin) %>%
ggplot(aes(x = tree_density, y = resid, color = pruning_system)) +
geom_point() +
labs(title = "Residuos del modelo", x = "Densidad de árboles", y = "Residuos") +
theme_bw()
tree
a <-
```
knitr::opts_chunk$set(echo = TRUE)
hist(rnorm(100))
a<-
```
str_detect("organic", "\\b[Oo]rganic\\b")
str_detect("Organic", "\\b[Oo]rganic\\b")
str_detect("Organic", "\\b[o]rganic\\b")
str_detect("Organic", "\\b[Oo]rganic\\b")
palabra <- "Organic"
str_detect(palabra, "\\b[Oo]rganic\\b")
str_detect(palabra, "\\b[Oo]rganic\\b") | str_detect(palabra, "\\b[Cc]hocolate\\b")
departments <- read_csv("departments.csv")
products <- read_csv("products.csv")
orders <- read_csv("orders.csv")
orders
"11"
"11"*2
knitr::opts_chunk$set(echo = T, warning = F, message = F)
knitr::opts_chunk$set(fig.width=8, fig.height=6)
library(tidyverse)
library(modelr)
knitr::opts_chunk$set(eval=F, echo = F, message = F, warning = F, fig.width = 8, fig.height = 5)
library(tidyverse)
library(lubridate)
library(modelr)
car <- read_csv("data/car_fuel.csv")
car <- car %>% mutate(speed2 = speed^2)
cf_mod <- lm(fuel_consumption ~ speed + speed2 + ac_state, data = car)
coef(cf_mod)
car %>% data_grid(speed, ac_state)
car %>% data_grid(speed, ac_state) %>%
mutate(speed2 = speed^2)
car %>% data_grid(speed, ac_state) %>%
mutate(speed2 = speed^2) %>%
add_predictions(cf_mod)
ggplot(car, aes(x = speed, y = fuel_consumption, color = ac_state)) +
geom_point(alpha = 0.6) +
geom_line(data = grid, aes(y = pred), size = 1.2) +
theme_minimal()
grid <- car %>% data_grid(speed, ac_state) %>%
mutate(speed2 = speed^2) %>%
add_predictions(cf_mod)
ggplot(car, aes(x = speed, y = fuel_consumption, color = ac_state)) +
geom_point(alpha = 0.6) +
geom_line(data = grid, aes(y = pred), size = 1.2) +
theme_minimal()
car %>% data_grid(speed, ac_state) %>%
mutate(speed2 = speed^2) %>%
add_predictions(cf_mod)
car %>% add_residuals(cf_mod) %>%
ggplot(aes(x = speed, y = resid, color = ac_state)) +
geom_point(alpha = 0.7) +
theme_minimal()
mod2 <- lm(fuel_consumption ~ speed + speed2, data = car)
car %>% add_residuals(mod2) %>%
ggplot(aes(x = speed, y = resid, color = ac_state)) +
geom_point(alpha = 0.7) +
theme_minimal()
weather <- read_csv("data/london_weather.csv")
air <- read_csv("data/london_air_quality.csv")
air
weather
air %>% mutate(date = as.Date(date))
air %>% mutate(date = as.Date(date)) %>% group_by(date) %>%
summarise(avg_pm25 = mean(bg_pm25, na.rm = TRUE))
air %>% mutate(date = as.Date(date)) %>% group_by(date) %>%
summarise(avg_pm25 = mean(bg_pm25, na.rm = TRUE)) %>%
inner_join(weather, by = "date")
air %>% mutate(date = as.Date(date)) %>% group_by(date) %>%
summarise(avg_pm25 = mean(bg_pm25, na.rm = TRUE)) %>%
inner_join(weather, by = "date") %>%
filter(tmean_q == 0) %>%
ggplot(aes(x = tmean, y = avg_pm25)) +
geom_point() +
geom_smooth(method = "lm") +
labs(x = "Temperatura media (°C)", y = "PM2.5 (microgramos/m3)", title = "Concentración media de PM2.5 por temperatura") +
theme_minimal()
library(tidyverse)
library(modelr)
mod_diamond <- lm(price ~ carat, data = diamonds)
summary(mod_diamond)
grid <- diamonds %>%
data_grid(carat = seq_range(carat, 40)) %>%
add_predictions(mod_diamond, "price")
diamonds %>% add_residuals(mod_diamond, "resid")
ggplot(diamonds, aes(carat, price)) +
geom_hex(bins = 50) +
geom_line(data = grid, colour = "red", size = 1)
ggplot(diamonds, aes(carat, price)) +
geom_hex(bins = 50) +
geom_line(data = grid, colour = "red")
ggplot(diamonds, aes(carat, price)) +
geom_point() +
geom_line(data = grid, colour = "red")
diamonds2 <- diamonds %>%
filter(carat <= 2.5) %>%
mutate(lprice = log2(price), lcarat = log2(carat))
mod_diamond <- lm(lprice ~ lcarat, data = diamonds2)
coefficients(mod_diamond)
grid <- diamonds2 %>% data_grid(lcarat) %>%
add_predictions(mod_diamond, "lpred")
ggplot(diamonds2, aes(lcarat)) +
geom_point( aes(y=lprice) ) +
geom_line(data = grid, aes(y=lpred), colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
grid <- diamonds2 %>%
data_grid(carat) %>%
mutate(lcarat = log2(carat)) %>%
add_predictions(mod_diamond, "lprice") %>%
mutate(price = 2 ^ lprice)
ggplot(diamonds2, aes(carat, price)) +
geom_point() +
geom_point(data = grid, colour = "red", size = 1)
diamonds2 <- diamonds2 %>%
add_residuals(mod_diamond, "lresid")
ggplot(diamonds2, aes(lcarat, lresid)) +
geom_point()
library(tidyverse)
library(nycflights13)
library(lubridate)
library(tidyquant)
x1 <- "El paciente tiene 57 años"
x2 <- "La edad de mi hermana es 36 años"
x3 <- "A sus 23 años, tenía talla 36"
x4 <- "Tan solo tiene 1 año!"
datos <- c(x1,x2,x3,x4)
tmp <- str_extract_all(datos, pattern = "\\d+.año.")
tmp
as.character(tmp)
tmp <- as.character(tmp)
tmp
as.numeric(str_extract(tmp, pattern = "\\d+"))
as.numeric(str_extract_all(tmp, pattern = "\\d+"))
amz <- read_csv("data/amazon_reviews.csv")
amz %>% mutate(review = str_to_lower(review))
